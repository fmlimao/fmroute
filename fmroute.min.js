var FMRoute=function(){function t(){this.routes=[],this.previous_route=null,this.current_route=null,this.default_callback={404:function(t,e,n){console.dir(n+": 404 NOT FOUND"),e()},before:function(t,e,n){e()},after:function(t,e){}},this.block=!1}return t.prototype={get:function(t,e,n){e=e||function(t,e){e()},n=n||function(t,e){e()},t=this.clearPath(t),path_elements=this.splitPath(t),t="/"+t;var i={path:t,path_elements:path_elements,callback_enter:e,callback_exit:n};this.routes.push(i)},run:function(){this.clearPathname(),this.startHashListener(),this.getCurrentHash()},stop:function(){this.block=!0},start:function(){this.block=!1},clearPathname:function(){var t="/"+window.location.pathname.split("/").reduce(function(t,e){return""!=e.trim()&&t.push(e.trim()),t},[]).join("/")+"/";window.location.pathname!=t&&window.history.pushState("/",document.title,t)},startHashListener:function(){var t=this;window.addEventListener("hashchange",function(){t.getCurrentHash()},!1)},getCurrentHash:function(){if(!this.block){var t=window.location.hash;""==t?window.location.hash="/":(this.changePreviousCurrentRoute(t),this.executeRoutes())}},executeRoutes:function(){var t=this,e=this.default_callback.before,n=this.default_callback.after,i=this.getExitCallback(),r=this.getEnterCallback();e(r[1],function(){i[0](i[1],function(){r[0](r[1],function(){n(r[1],t.current_route)},t.current_route)})},t.current_route)},clearPath:function(t){return t=t.trim(),t=t.replace("#",""),"/"==t.substring(0,1)&&(t=t.substring(1)),"/"==t.slice(-1)&&(t=t.slice(0,-1)),t},splitPath:function(t){return t=t.split("/")},changePreviousCurrentRoute:function(t){this.previous_route=this.current_route,this.current_route=t},getExitCallback:function(){var t=function(t,e){e()},e={};if(this.previous_route){var n=this.checkPathExists(this.previous_route);n&&(t=n[0].callback_exit,e=n[1])}return[t,e]},getEnterCallback:function(){var t=this.default_callback[404],e={};if(this.current_route){var n=this.checkPathExists(this.current_route);n&&(t=n[0].callback_enter,e=n[1])}return[t,e]},checkPathExists:function(t){var e=this.clearPath(t);e=this.splitPath(e);var n=null,i=this.routes;for(var r in i){var a=i[r];if(a.path_elements.length==e.length){var u=!0,s={};for(var c in a.path_elements){var o=a.path_elements[c],h=this.isPathVar(o);h?s[h]=e[c]:o!=e[c]&&(u=!1)}if(u){n=[a,s];break}}}return n},isPathVar:function(t){return":"==t.substring(0,1)&&t.substring(1)},error:function(t,e){this.default_callback[t]=e},before:function(t){this.default_callback.before=t},after:function(t){this.default_callback.after=t},go:function(t){window.location.hash=t}},t}();